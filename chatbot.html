<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CivicAssist Chatbot</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
       
        #chat-history::-webkit-scrollbar {
            width: 6px;
        }
        #chat-history::-webkit-scrollbar-thumb {
            background-color: #6366f1; 
            border-radius: 3px;
        }
        #chat-history::-webkit-scrollbar-track {
            background-color: #1f2937;
        }
       
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; 
        }
     
        .option-button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 10px;
            background-color: #374151; 
            color: white;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .option-button:hover {
            background-color: #4b5563; 
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

  
    <div class="w-full max-w-lg bg-gray-800 rounded-xl shadow-2xl overflow-hidden flex flex-col h-[85vh] md:h-[700px]">

       
        <div class="p-4 bg-indigo-700 text-white shadow-md flex items-center rounded-t-xl">
            <svg class="w-6 h-6 mr-3 text-indigo-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.693a9 9 0 01-1.395-3.218z"></path></svg>
            <h1 class="text-xl font-bold">CivicBot ü§ñ</h1>
            <p class="ml-auto text-sm opacity-75">Online</p>
        </div>

       
        <div id="chat-history" class="flex-grow p-4 overflow-y-auto space-y-4">
       
        </div>

       
        <div id="input-area" class="p-4 bg-gray-700 flex items-center border-t border-gray-600">
            <input type="text" id="user-input" placeholder="Type your name or message..."
                   class="flex-grow p-3 rounded-l-lg bg-gray-900 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 border-r-0"
                   onkeydown="if(event.key === 'Enter') handleInput()">
            <button onclick="handleInput()" id="send-button"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-r-lg shadow-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                Send
            </button>
        </div>
    </div>

    <script>
       
        let chatStep = 0; 
        let userName = '';
        const chatHistory = document.getElementById('chat-history');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const botName = 'CivicBot';

        
        function addMessage(sender, content) {
            const messageDiv = document.createElement('div');
            const isBot = sender === 'bot';
            
           
            messageDiv.className = `flex ${isBot ? 'justify-start' : 'justify-end'} mb-4`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = `max-w-xs lg:max-w-md p-3 rounded-xl shadow-lg transition duration-300 ${
                isBot 
                ? 'bg-gray-700 text-white rounded-tl-none' 
                : 'bg-indigo-500 text-white rounded-br-none'
            }`;
            
          
            const senderSpan = document.createElement('span');
            senderSpan.className = `font-bold text-xs ${isBot ? 'text-indigo-300' : 'text-indigo-100'} block mb-1`;
            senderSpan.textContent = isBot ? botName : 'You';

            contentDiv.appendChild(senderSpan);
            
            
            const contentElement = document.createElement('div');
            contentElement.innerHTML = content;
            contentDiv.appendChild(contentElement);
            
            messageDiv.appendChild(contentDiv);
            chatHistory.appendChild(messageDiv);
            
            
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

       
        function toggleInput(enabled) {
            if (enabled) {
                userInput.disabled = false;
                sendButton.disabled = false;
                sendButton.classList.remove('opacity-50');
                userInput.placeholder = chatStep === 1 ? 'Type your name...' : 'Type your message...';
                userInput.focus();
            } else {
                userInput.disabled = true;
                sendButton.disabled = true;
                sendButton.classList.add('opacity-50');
                userInput.placeholder = 'Please select an option above...';
            }
        }

       
        function greetUser() {
            addMessage('bot', "Hello! I'm CivicBot, your virtual assistant for connecting with your municipality. I can help you report issues and find information.");
            setTimeout(() => {
                addMessage('bot', "What is your name, please?");
                chatStep = 1; 
                toggleInput(true);
            }, 1500);
        }

        function handleInput() {
            
            if (userInput.disabled) return; 
            
            const input = userInput.value.trim();
            if (input === '') return;

            addMessage('user', input);
            userInput.value = ''; 

          
            setTimeout(() => {
                getBotResponse(input);
            }, 800);
        }

        window.handleOptionClick = function(option, optionName) {
            
            addMessage('user', `**${option}. ${optionName}**`); 
            
            let responseText = '';
            toggleInput(false); 

           
            switch (option) {
                case 1: 
                    responseText = `(1) Complaint Category: I see you want to report an issue. To ensure fast resolution, we need to identify the category (e.g., Pothole, Water Leak, Illegal Dumping). I will now direct you to the **Report Page** to fill out the details.
                    
                    *Simulation: This action would submit a pre-filled form or redirect you to /report.*

                    Thank you, ${userName}. Your issue is being logged!`;
                    
                 
                    setTimeout(() => {
                        addMessage('bot', responseText);
                        askForContinuation(); 
                    }, 1000);
                    break;
                case 2: 
                    responseText = `(2) Image Analysis: We use AI to speed up issue logging! Please upload your image and describe what it shows (e.g., "A deep pothole in front of 123 Main St" or "A broken street light"). You can type your description now.`;
                    
                    addMessage('bot', responseText);
                    chatStep = 3; 
                    toggleInput(true); 
                    userInput.placeholder = 'Type your image description...';
                    break;

                case 3: 
                    responseText = `(3) Nearby Services: To find services like libraries, recycling centers, or health clinics, I need to know your current location or a target address/pin code. Please type your location now.`;
                    
                    addMessage('bot', responseText);
                    chatStep = 3; 
                    toggleInput(true); 
                    userInput.placeholder = 'Type your address or location...';
                    break;

                case 4:
                    const civicFacts = [
                        "Did you know that participatory budgeting allows citizens to suggest and vote on how to spend part of a public budget?",
                        "A typical municipal budget focuses 40% on public safety and 30% on infrastructure upkeep.",
                        "Civic engagement, even just reporting a pothole, drastically improves quality of life for everyone!",
                        "Local elections often have the biggest impact on your daily life, from trash collection to school funding."
                    ];
                    const fact = civicFacts[Math.floor(Math.random() * civicFacts.length)];
                    responseText = `(4) Civic Education: Here is a quick fact about civic life: "${fact}"`;
                    
                   
                    setTimeout(() => {
                        addMessage('bot', responseText);
                        askForContinuation();
                    }, 1000);
                    break;
            }
        }
        
       
        function getBotResponse(input) {
            let responseText = '';
            toggleInput(false); 

            switch (chatStep) {
                case 1: 
                    userName = input.split(' ')[0]; 
                    responseText = `It's great to meet you, ${userName}! Since you're already logged in, let's get started. How can I assist you with a civic issue today?`;
                    
                    addMessage('bot', responseText);
                    showMainMenu();
                    chatStep = 2;
                    break;

                case 3: 
                    responseText = `I've noted your input regarding your request ("${input}"). Your information has been saved for review.`;
                    addMessage('bot', responseText);

                    
                    setTimeout(() => {
                        addMessage('bot', `Please use our dedicated Report form if you need to submit further details. What would you like to do next?`);
                        askForContinuation();
                    }, 1500);
                    break;
            }
        }

        
        function showMainMenu() {
            const menuOptions = [
                { id: 1, name: 'Complaint Category Identification', icon: 'üö®' },
                { id: 2, name: 'Image Analysis (Issue Recognition)', icon: 'üì∏' },
                { id: 3, name: 'Nearby Services (Find Help)', icon: 'üìç' },
                { id: 4, name: 'Civic Education (Quick Facts)', icon: 'üéì' }
            ];

            
            const questionText = `What else can I help you with, ${userName}? Please click on one of the options below:`;
            addMessage('bot', questionText);
            
            
            let buttonsHtml = '<div class="mt-2 space-y-2">';
            menuOptions.forEach(option => {
                buttonsHtml += `
                    <button class="option-button flex items-center" onclick="handleOptionClick(${option.id}, '${option.name}')">
                        <span class="mr-3 text-xl">${option.icon}</span>
                        ${option.id}. ${option.name}
                    </button>
                `;
            });
            buttonsHtml += '</div>';

          
            setTimeout(() => {
                addMessage('bot', buttonsHtml);
                toggleInput(false); 
            }, 1000);
        }
        
        function askForContinuation() {
            chatStep = 4; 
            const questionText = `Is there anything else I can help you with today, ${userName}?`;
            
            const buttonsHtml = `
                <div class="mt-2 space-y-2">
                    <button class="option-button flex items-center bg-indigo-600 hover:bg-indigo-700" onclick="handleContinuationClick(true)">
                        <span class="mr-3 text-xl">‚úÖ</span> Yes, show the main menu
                    </button>
                    <button class="option-button flex items-center bg-gray-600 hover:bg-gray-500" onclick="handleContinuationClick(false)">
                        <span class="mr-3 text-xl">üëã</span> No, I'm done.
                    </button>
                </div>
            `;

            setTimeout(() => {
                addMessage('bot', questionText);
                addMessage('bot', buttonsHtml);
                toggleInput(false);
            }, 500);
        }

        
        window.handleContinuationClick = function(continueChat) {
            toggleInput(false);
            
            if (continueChat) {
                addMessage('user', "Yes, show the main menu");
                
                showMainMenu();
                chatStep = 2;
            } else {
                addMessage('user', "No, I'm done.");
               
                setTimeout(() => {
                    addMessage('bot', `Thank you for using CivicBot today, ${userName}. Have a wonderful day! Goodbye.`);
                    
                   
                    userInput.disabled = true;
                    sendButton.disabled = true;
                    sendButton.classList.add('opacity-50');
                    userInput.placeholder = 'Chat session ended.';
                    userInput.value = '';
                    chatStep = 5; 
                }, 1000);
            }
        }

        
        window.onload = greetUser;

    </script>
</body>
</html>
